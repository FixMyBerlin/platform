
<div id="menu_button" class="menu_button_hud">
    <a href="/ueber-uns">
        <div id="menu_button_label">Über uns</div>
        <div id="menu_button_circle"><div>i</div></div>
    </a>
</div>


<section id="splashscreen">
    <div id="splashscreen_back" onclick="this.parentNode.style.display='none';"></div>
    <div id="splashscreen_container">
        <div id="splashscreen_text">
            <div id="splashscreen_text_statement">Wie sieht Berlin aus, wenn wir überall mit dem Fahrrad sicher und entspannt unterwegs sein können? Wie können wir dieses Ziel miteinander am schnellsten erreichen?</div>
            <br>
            FixMyBerlin ist in der Entwicklung. Die Karte zeigt zunächst die vorhandenen Radverkehrsanlagen in Berlin, so wie sie von der Senatsverwaltung zur Verfügung gestellt werden. Dazu werden die Unfallschwerpunkte der letzten 2 Jahre abgebildet. (Dank an Stefan Wehrmeyer) Die Plattform soll zukünftig Radverkehrsplanungen des Senates und der Bezirke übersichtlich abbilden und verschiedene Feedback- und Beteiligungsmöglichkeiten bieten. Für aktuelle Informationen abonniert unseren Newsletter. <a>Kontakt</a> für Feedback und Anregungen.
            <input type="email" id="splashscreen_newsletter_email" placeholder="Deine E-Mail Adresse">
            <div id="splashscreen_newsletter_email_button">Newsletter abonnieren</div>
            {{ block_simple_newsletter }}
        </div>
        <img id="splashscreen_logo" src="/themes/fixmycustom/logo.png">
    </div>
</section>

<script type="text/javascript">

    var current_timestamp=Date.now();

    var last_saved_timestamp=localStorage.getItem("splashscreen_timestamp");

    if ( last_saved_timestamp==null || current_timestamp-last_saved_timestamp > 1 * 24 * 60 * 60 * 1000  ) { // 1 min
        localStorage.setItem("splashscreen_timestamp",current_timestamp);
        document.getElementById("splashscreen").style.display="block";
    }

</script>



<div id="map_container" onclick="mapOverlayToggle()"  onmousemove="mapOverlayBlock()">

  <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/3.15/themes/css/cartodb.css" />

  <div id="map"></div>

  <script src="http://libs.cartocdn.com/cartodb.js/v3/3.15/cartodb.js"></script>
  <style type="text/css" id="berliner_bezirke">
    #layer {
      polygon-fill: ramp([spatial_name], (#5F4690, #a0d9f1, #38A6A5, #0F8554, #73AF48, #EDAD08, #f49a2f, #CC503E, #94346E, #6F4070, #666666), ("01", "02", "03", "04", "05", "06", "07", "08", "09", "10"), "=");
      polygon-opacity: 0.0;
      line-width: 3;
      line-color: #e7abab;
      line-opacity: 0.7;

    #XHain [spatial_name='02']{
      polygon-fill: #a0d9f1;
      polygon-opacity: 0.3;
      line-width: 3;
      line-color: #a3a3a3;
      }
    #Pank [spatial_name='03']{
      polygon-fill: #e7ce90;
      polygon-opacity: 0.1;
      line-width: 3;
      line-color: #a3a3a3;
      }
      #Span [spatial_name='05']{
      polygon-fill: #e7ce90;
      polygon-opacity: 0.1;
      line-width: 3;
      line-color: #a3a3a3;
        }
     #TS [spatial_name='07']{
      polygon-fill: #e7ce90;
      polygon-opacity: 0.1;
      line-width: 3;
      line-color: #a3a3a3;
      }
    }
  </style>
  <style type="text/css" id="radverkehrsprojekte">
    #layer {
      line-width: 7;
      line-color: ramp([type_feedback], (#cd38c6, #641d96, #df98e8), ("Feedback", "Like", "Review"), "=");
    }
  </style>
  <script>
    var map = new L.Map('map', {
      center: [52.520645, 13.409779],
      zoom: 13,
      minZoom: 12,
      maxZoom: 15,
    });

    L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
        attribution: 'Positron'
      }).addTo(map);

    // Layer Bezirke
    cartodb.createLayer(map, {
        user_name: 'hejco',
        type: 'cartodb',
        sublayers: [{
          sql: "SELECT * FROM berliner_bezirke",
          cartocss: $('#berliner_bezirke').html(),
        }]
      })
      .addTo(map);

    // Layer XBerg Maßnahmen
    cartodb.createLayer(map, {
        user_name: 'bosh',
        type: 'cartodb',
        sublayers: [{
          sql: "SELECT * FROM radverkehrsprojekte WHERE do_import='1'",
          cartocss: $('#radverkehrsprojekte').html(),
          interactivity: "cartodb_id, uuid",
        }]
      })
      .addTo(map)
      .on('done', function(layer) {
        layer.setInteraction(true);
        layer.on('featureClick', function(e, latlng, pos, data) {
          loadProjectByUUID(data, latlng);
        })
        .on('error', function(data) {
          alert("error: " + data);
        });
      })
      .on('error', function(data) {
        alert("error: " + data);
      });
  </script>
</div>

<script>

    var is_map_overlay_visible=false;
    var is_map_overlay_blocked=false;

    // mapping project uuid to nid and alias
    var project_mapping = {{ project_mapping|json_encode|raw }};
    function loadProjectByUUID(data, latlng){
      console.log(project_mapping['9c48e1bf-abad-4892-8f61-b5c1a60f47f4']);
      console.log(project_mapping['9c48e1bf-abad-4892-8f61-b5c1a60f47f4'].alias);
    }

    function mapOverlayToggle() {
        if (!is_map_overlay_blocked) {
            if (is_map_overlay_visible) {
                is_map_overlay_visible=false;
                document.getElementById("map_overlay_container").className="map_overlay_container_hidden";
            } else {
                is_map_overlay_visible=true;
                document.getElementById("map_overlay_container").className="";
            }
        }
        is_map_overlay_blocked=false;
    }

    var deblock_timer=null;

    function mapOverlayBlock() {
        is_map_overlay_blocked=true;
        window.clearTimeout(deblock_timer);
        deblock_timer=window.setTimeout("is_map_overlay_blocked=false", 100);

    }

</script>


<div id="map_overlay_container" class="map_overlay_container_hidden">

    <div id="map_overlay_triangle"></div>

    <div id="map_overlay_head">
        <h2 id="map_overlay_head_label">
            Projekt #{{ content.field_project_number }}<br>
            Neubau Radanlage
            {{ content.field_project_status }}
        </h2>
    </div>

    <div id="map_overlay_data">

        <ul id="map_overlay_gallery">
            {{ content.field_project_images }}
        </ul>

        <h1 id="map_overlay_head_title">
            {{ node.label }}
            <div style="display:none;">
           {{ content.votingapi_links }}
           </div>
        </h1>

        <div class="map_overlay_title">Ziel dieser Maßnahme</div>
        <div class="map_overlay_content">{{ content.body }}</div>

        <div class="map_overlay_divide"><div></div><div></div></div>

        <div class="map_overlay_title">Fakten zur Maßnahme</div>
        <div class="map_overlay_content">
            <span class="map_overlay_content_fact"><span>Bauzeit:</span> Vorrausichtlich Februar – Mai 2018</span>
            <span class="map_overlay_content_fact"><span>Kosten:</span> ca 30.000 €</span>
            <a>weitere Fakten</a>
        </div>

        <div class="map_overlay_divide"><div></div><div></div></div>

        <div class="map_overlay_title">Zahlen und Daten</div>
        <div id="map_overlay_bignumber_slider">
            <div class="map_overlay_bignumber_element">
                <div class="map_overlay_bignumber">+20%</div>
                <div class="map_overlay_bignumber_label">mehr Radverkehr seit 2005</div>
            </div>
            <div class="map_overlay_bignumber_element">
                <div class="map_overlay_bignumber">-15%</div>
                <div class="map_overlay_bignumber_label">weniger Feinstaub (Ziel bis 2019)</div>
            </div>
            <div class="map_overlay_bignumber_element">
                <div class="map_overlay_bignumber">-30%</div>
                <div class="map_overlay_bignumber_label">weniger schwere Unfälle (Ziel bis 2018)</div>
            </div>
            <div class="map_overlay_bignumber_element">
                <div class="map_overlay_bignumber">-17%</div>
                <div class="map_overlay_bignumber_label">weniger Lärm für die Anwohner</div>
            </div>
        </div>

    </div>
    <div id="map_overlay_voting">
        <div class="map_overlay_voting_container" id="map_overlay_voting_container_gut" onclick="votingAction(this);">
            <div class="map_overlay_voting_icon"></div>
            <div class="map_overlay_voting_description">Find ich gut!</div>
        </div>
        <div class="map_overlay_voting_container" id="map_overlay_voting_container_gut_aber" onclick="votingAction(this);">
            <div class="map_overlay_voting_icon"></div>
            <div class="map_overlay_voting_description">Gut, aber</div>
        </div>
        <div class="map_overlay_voting_container" id="map_overlay_voting_container_gefallt_mir_nicht" onclick="votingAction(this);">
            <div class="map_overlay_voting_icon"></div>
            <div class="map_overlay_voting_description">Gefällt mir nicht!</div>
        </div>
        <div id="map_overlay_voting_feedback">
            <div id="map_overlay_voting_feedback_title">
                <div class="map_overlay_voting_feedback_title_element" id="map_overlay_voting_feedback_title_gut_aber">Was stört euch an dieser Maßnahme?</div>
                <div class="map_overlay_voting_feedback_title_element" id="map_overlay_voting_feedback_title_gefallt_mir_nicht">Was könnte an dieser Maßnahme noch verbessert werden?</div>
            </div>
            <div id="map_overlay_voting_feedback_placeholder">
                <div id="map_overlay_voting_feedback_placeholder_gut_aber">Schreibt uns eure Einwände</div>
                <div id="map_overlay_voting_feedback_placeholder_gefallt_mir_nicht">Schreibt uns eure Anregungen</div>
            </div>
            <textarea id="map_overlay_voting_feedback_field"></textarea>
            <div id="map_overlay_voting_feedback_send"><div>Abschicken</div></div>
        </div>
    </div>

</div>
